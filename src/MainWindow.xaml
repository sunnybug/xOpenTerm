<Window x:Class="xOpenTerm.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:xOpenTerm"
        Title="xOpenTerm" Height="600" Width="1000"
        Icon="pack://application:,,,/xOpenTerm;component/icons/icon.ico"
        Background="{StaticResource BgDark}"
        PreviewKeyDown="MainWindow_PreviewKeyDown">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <!-- 顶栏菜单 (现代化间距) -->
        <Menu x:Name="MainMenu" Grid.Row="0" Background="{StaticResource BgSidebar}" Foreground="{StaticResource TextPrimary}" Padding="6,4">
            <MenuItem Header="设置(_S)">
                <MenuItem Header="字体(_F)" Click="MenuFontSettings_Click"/>
                <MenuItem Header="登录凭证(_P)" Click="MenuCredentials_Click"/>
                <MenuItem Header="隧道管理(_T)" Click="MenuTunnels_Click"/>
                <MenuItem Header="恢复配置(_R)" Click="MenuRestoreConfig_Click"/>
            </MenuItem>
            <MenuItem Header="主密码(_M)">
                <MenuItem Header="设置主密码(_S)" Click="MenuMasterPasswordSet_Click"/>
                <MenuItem Header="清除主密码(_C)" Click="MenuMasterPasswordClear_Click"/>
            </MenuItem>
            <MenuItem Header="帮助(_H)">
                <MenuItem Header="关于(_A)" Click="MenuAbout_Click"/>
            </MenuItem>
        </Menu>
        <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="LeftColumn" Width="260" MinWidth="180"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧：Tab（服务器/远程文件）- 与右侧统一使用 AppTabItemStyle -->
        <Border Grid.Column="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0"
                Background="{StaticResource BgSidebar}" CornerRadius="0,8,8,0" Margin="0,0,0,0">
            <TabControl x:Name="LeftTabControl" Margin="0" Padding="6,6,6,0"
                        Background="Transparent" BorderThickness="0"
                        ItemContainerStyle="{StaticResource AppTabItemStyle}">
                    <TabItem Header="服务器">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" Margin="8,8,8,6">
                                <TextBox x:Name="ServerSearchBox" Padding="10,8"
                                         Foreground="{StaticResource TextPrimary}" Background="{StaticResource BgInput}"
                                         BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                         TextChanged="ServerSearchBox_TextChanged"
                                         ToolTip="按节点名称、主机地址、用户名快速过滤"/>
                                <TextBlock x:Name="ServerSearchBoxPlaceholder" Text="Ctrl+Q"
                                           Margin="10,8,8,8" VerticalAlignment="Center"
                                           Foreground="{StaticResource TextSecondary}"
                                           IsHitTestVisible="False"/>
                            </Grid>
                            <TreeView x:Name="ServerTree" Grid.Row="1" Margin="4,4,4,8"
                                      Background="Transparent" Foreground="{StaticResource TextPrimary}"
                                      BorderThickness="0" SelectedItemChanged="ServerTree_SelectedItemChanged"
                                      MouseDoubleClick="ServerTree_MouseDoubleClick" MouseRightButtonDown="ServerTree_MouseRightButtonDown"
                                      ContextMenuOpening="ServerTree_ContextMenuOpening"
                                      AllowDrop="False" PreviewMouseLeftButtonDown="ServerTree_PreviewMouseLeftButtonDown"
                                      PreviewKeyDown="ServerTree_PreviewKeyDown">
                                <TreeView.ContextMenu>
                                    <!-- 占位：无此占位时 WPF 在首次右键不会触发 ContextMenuOpening，菜单在 Opening 中动态替换 -->
                                    <ContextMenu/>
                                </TreeView.ContextMenu>
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                                        <EventSetter Event="RequestBringIntoView" Handler="ServerTree_RequestBringIntoView"/>
                                        <Style.Triggers>
                                            <Trigger Property="local:MainWindow.IsMultiSelected" Value="True">
                                                <Setter Property="Background" Value="{StaticResource BgInput}"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </TreeView.ItemContainerStyle>
                            </TreeView>
                        </Grid>
                    </TabItem>
                    <TabItem Header="远程文件">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock x:Name="RemoteFileTitle" Grid.Row="0" Text="远程文件" Margin="12,10,12,8"
                                       Foreground="{StaticResource TextPrimary}" FontWeight="SemiBold"/>
                            <TextBox x:Name="RemotePathBox" Grid.Row="1" Margin="8,0,8,6" Padding="10,8"
                                     Background="{StaticResource BgInput}" Foreground="{StaticResource TextPrimary}" CaretBrush="{StaticResource TextPrimary}"
                                     BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                     KeyDown="RemotePathBox_KeyDown"/>
                            <ListView x:Name="RemoteFileList" Grid.Row="2" Margin="4,0,4,8"
                                     Background="Transparent" Foreground="{StaticResource TextPrimary}"
                                     BorderThickness="0" MouseDoubleClick="RemoteFileList_MouseDoubleClick"
                                     ContextMenuOpening="RemoteFileList_ContextMenuOpening"
                                     PreviewKeyDown="RemoteFileList_PreviewKeyDown">
                                <ListView.ContextMenu>
                                    <ContextMenu x:Name="RemoteFileListContextMenu">
                                        <MenuItem x:Name="RemoteFileMenuEdit"   Header="编辑(_E)" Click="RemoteFileList_Edit_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuRename" Header="改名(_R)" Click="RemoteFileList_Rename_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuPermissions" Header="编辑权限(_P)" Click="RemoteFileList_Permissions_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuDelete" Header="删除(_D)" Click="RemoteFileList_Delete_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuDownload" Header="下载(_L)" Click="RemoteFileList_Download_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuUpload" Header="上传(_U)" Click="RemoteFileList_Upload_Click"/>
                                    </ContextMenu>
                                </ListView.ContextMenu>
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="名称" Width="200">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <Image Source="{Binding IconImage}" Width="16" Height="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="大小" Width="80" DisplayMemberBinding="{Binding DisplaySize}"/>
                                        <GridViewColumn Header="修改时间" Width="130" DisplayMemberBinding="{Binding DisplayModifiedTime}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Grid>
                    </TabItem>
                </TabControl>
        </Border>

        <GridSplitter Grid.Column="1" Width="6" HorizontalAlignment="Center" VerticalAlignment="Stretch"
                      Background="{StaticResource BorderBrush}"/>

        <!-- 右侧：标签 + 终端（与左侧统一使用 AppTabItemStyle），tab 栏不铺满整行 -->
        <TabControl x:Name="TabsControl" Grid.Column="2" Padding="0" Margin="0"
                    Style="{StaticResource ConnectionTabsControlStyle}"
                    Background="{StaticResource BgDark}" BorderThickness="0"
                    SelectionChanged="TabsControl_SelectionChanged"
                    ItemContainerStyle="{StaticResource AppTabItemStyle}"/>
        </Grid>
    </Grid>
</Window>
