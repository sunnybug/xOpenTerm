<Window x:Class="xOpenTerm.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:local="clr-namespace:xOpenTerm"
        Title="xOpenTerm" Height="600" Width="1000"
        Icon="pack://application:,,,/xOpenTerm;component/icons/icon.ico"
        Background="{StaticResource BgDark}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <!-- 顶栏菜单 -->
        <Menu Grid.Row="0" Background="{StaticResource BgSidebar}" Foreground="White" Padding="4,2">
            <MenuItem Header="设置">
                <MenuItem Header="字体" Click="MenuFontSettings_Click"/>
                <MenuItem Header="登录凭证" Click="MenuCredentials_Click"/>
                <MenuItem Header="隧道管理" Click="MenuTunnels_Click"/>
                <MenuItem Header="配置目录" Click="MenuOpenConfigDir_Click"/>
            </MenuItem>
            <MenuItem Header="帮助">
                <MenuItem Header="关于" Click="MenuAbout_Click"/>
                <MenuItem Header="检查更新" Click="MenuUpdate_Click"/>
            </MenuItem>
        </Menu>
        <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="LeftColumn" Width="260" MinWidth="180"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧：Tab（服务器/远程文件） -->
        <Border Grid.Column="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0"
                Background="{StaticResource BgSidebar}">
            <TabControl x:Name="LeftTabControl" Margin="0" Padding="4,4,4,0"
                        Background="Transparent" BorderThickness="0">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Border x:Name="Border" Background="Transparent" Padding="10,6" Margin="0,0,4,0"
                                                BorderThickness="0" Cursor="Hand">
                                            <ContentPresenter ContentSource="Header"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="{StaticResource BgInput}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>
                    <TabItem Header="服务器">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBox x:Name="ServerSearchBox" Grid.Row="0" Margin="8,8,8,4" Padding="8,6"
                                     Foreground="{StaticResource TextPrimary}" Background="{StaticResource BgInput}"
                                     BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                     TextChanged="ServerSearchBox_TextChanged"
                                     ToolTip="按节点名称、主机地址、用户名快速过滤"/>
                            <TreeView x:Name="ServerTree" Grid.Row="1" Margin="4,4,4,8"
                                      Background="Transparent" Foreground="{StaticResource TextPrimary}"
                                      BorderThickness="0" SelectedItemChanged="ServerTree_SelectedItemChanged"
                                      MouseDoubleClick="ServerTree_MouseDoubleClick" MouseRightButtonDown="ServerTree_MouseRightButtonDown"
                                      ContextMenuOpening="ServerTree_ContextMenuOpening"
                                      AllowDrop="True" PreviewMouseLeftButtonDown="ServerTree_PreviewMouseLeftButtonDown"
                                      PreviewMouseMove="ServerTree_PreviewMouseMove" DragOver="ServerTree_DragOver" Drop="ServerTree_Drop"
                                      PreviewKeyDown="ServerTree_PreviewKeyDown">
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                                        <Style.Triggers>
                                            <Trigger Property="local:MainWindow.IsMultiSelected" Value="True">
                                                <Setter Property="Background" Value="{StaticResource BgInput}"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </TreeView.ItemContainerStyle>
                            </TreeView>
                        </Grid>
                    </TabItem>
                    <TabItem Header="远程文件">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock x:Name="RemoteFileTitle" Grid.Row="0" Text="远程文件" Margin="12,10,12,6"
                                       Foreground="{StaticResource TextPrimary}" FontWeight="SemiBold"/>
                            <TextBox x:Name="RemotePathBox" Grid.Row="1" Margin="8,0,8,6" Padding="8,6"
                                     Background="{StaticResource BgInput}" Foreground="{StaticResource TextPrimary}" CaretBrush="{StaticResource TextPrimary}"
                                     BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                     KeyDown="RemotePathBox_KeyDown"/>
                            <ListView x:Name="RemoteFileList" Grid.Row="2" Margin="4,0,4,8"
                                     Background="Transparent" Foreground="{StaticResource TextPrimary}"
                                     BorderThickness="0" MouseDoubleClick="RemoteFileList_MouseDoubleClick"
                                     ContextMenuOpening="RemoteFileList_ContextMenuOpening"
                                     PreviewKeyDown="RemoteFileList_PreviewKeyDown">
                                <ListView.ContextMenu>
                                    <ContextMenu x:Name="RemoteFileListContextMenu">
                                        <MenuItem x:Name="RemoteFileMenuEdit"   Header="编辑" Click="RemoteFileList_Edit_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuRename" Header="改名" Click="RemoteFileList_Rename_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuPermissions" Header="编辑权限" Click="RemoteFileList_Permissions_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuDelete" Header="删除" Click="RemoteFileList_Delete_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuDownload" Header="下载" Click="RemoteFileList_Download_Click"/>
                                        <MenuItem x:Name="RemoteFileMenuUpload" Header="上传" Click="RemoteFileList_Upload_Click"/>
                                    </ContextMenu>
                                </ListView.ContextMenu>
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="名称" Width="200">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <Image Source="{Binding IconImage}" Width="16" Height="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="大小" Width="80" DisplayMemberBinding="{Binding DisplaySize}"/>
                                        <GridViewColumn Header="修改时间" Width="130" DisplayMemberBinding="{Binding DisplayModifiedTime}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Grid>
                    </TabItem>
                </TabControl>
        </Border>

        <GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Center" VerticalAlignment="Stretch"
                      Background="{StaticResource BorderBrush}"/>

        <!-- 右侧：标签 + 终端 -->
        <TabControl x:Name="TabsControl" Grid.Column="2" Padding="0" Margin="0"
                    Background="{StaticResource BgDark}" BorderThickness="0"/>
        </Grid>
    </Grid>
</Window>
