<Application x:Class="xOpenTerm.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             StartupUri="MainWindow.xaml"
             ShutdownMode="OnMainWindowClose">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- 先合并深色主题（提供 MaterialDesign.Brush.Primary.Light 等），再合并控件样式 -->
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Dark.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesign3.Defaults.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <!-- 现代化深色配色 (UI/UX Pro Max: Developer Tool / IDE - Code dark + run green) -->
            <SolidColorBrush x:Key="BgDark" Color="#0F172A"/>
            <SolidColorBrush x:Key="BgSidebar" Color="#1E293B"/>
            <SolidColorBrush x:Key="BgInput" Color="#334155"/>
            <SolidColorBrush x:Key="BorderBrush" Color="#475569"/>
            <SolidColorBrush x:Key="TextPrimary" Color="#F8FAFC"/>
            <SolidColorBrush x:Key="TextSecondary" Color="#94A3B8"/>
            <SolidColorBrush x:Key="Accent" Color="#22C55E"/>
            <SolidColorBrush x:Key="HoverBg" Color="#334155"/>
            <SolidColorBrush x:Key="ButtonBg" Color="#334155"/>
            <SolidColorBrush x:Key="ButtonHoverBg" Color="#475569"/>
            <SolidColorBrush x:Key="ButtonBorder" Color="#64748B"/>
            <SolidColorBrush x:Key="ButtonBorderHighlight" Color="#94A3B8"/>
            <SolidColorBrush x:Key="SelectionBg" Color="#334155"/>
            <SolidColorBrush x:Key="SelectionFg" Color="#FFFFFF"/>
            <!-- 圆角 (现代化块状风格，150–300ms 过渡) -->
            <CornerRadius x:Key="RadiusSm">4</CornerRadius>
            <CornerRadius x:Key="RadiusMd">6</CornerRadius>
            <CornerRadius x:Key="RadiusLg">8</CornerRadius>
            <!-- 键盘焦点样式：可见焦点环，便于无障碍与键盘导航 -->
            <Style x:Key="FocusVisual">
                <Setter Property="Control.Template">
                    <Setter.Value>
                        <ControlTemplate>
                            <Border BorderBrush="{StaticResource Accent}" BorderThickness="2" Margin="1" SnapsToDevicePixels="True"/>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- 全局按钮键盘焦点可见 -->
            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="FocusVisualStyle" Value="{StaticResource FocusVisual}"/>
            </Style>
            <!-- 勾选态复选框背景与对话框区分，避免与 BgDark 等背景融为一体 -->
            <Style TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
                <Setter Property="Background" Value="Transparent"/>
                <Style.Triggers>
                    <Trigger Property="IsChecked" Value="True">
                        <Setter Property="Background" Value="{StaticResource BgInput}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
            <!-- 可编辑输入框激活时显示并闪烁光标：全局设置 CaretBrush，非只读时可见 -->
            <Style TargetType="TextBox">
                <Setter Property="CaretBrush" Value="{StaticResource TextPrimary}"/>
            </Style>
            <Style TargetType="PasswordBox">
                <Setter Property="CaretBrush" Value="{StaticResource TextPrimary}"/>
                <Setter Property="MinHeight" Value="20"/>
            </Style>
            <!-- 默认窗口字体 (现代化可读性) -->
            <Style TargetType="Window">
                <Setter Property="FontFamily" Value="Segoe UI"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>
            <!-- 全局 Tab 样式：左侧服务器/远程文件 + 右侧终端，选中=灰底+强调底线，未选中=透明 -->
            <Style x:Key="AppTabItemStyle" TargetType="TabItem">
                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Border x:Name="TabBorder" Background="Transparent" Padding="{TemplateBinding Padding}"
                                    BorderThickness="0,0,0,2" BorderBrush="Transparent" Cursor="Hand"
                                    Margin="0,0,2,0">
                                <ContentPresenter ContentSource="Header" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="TabBorder" Property="Background" Value="{StaticResource BgInput}"/>
                                    <Setter TargetName="TabBorder" Property="BorderBrush" Value="{StaticResource Accent}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- 右侧连接 TabControl：tab 栏不铺满整行，仅占所需宽度 -->
            <Style x:Key="ConnectionTabsControlStyle" TargetType="TabControl">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabControl">
                            <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TabPanel x:Name="HeaderPanel" Grid.Row="0" IsItemsHost="True"
                                              HorizontalAlignment="Left"
                                              Panel.ZIndex="1"/>
                                    <ContentPresenter x:Name="PART_SelectedContentHost" Grid.Row="1"
                                                      ContentSource="SelectedContent" Margin="0"/>
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- 下拉框列表项样式：保证下拉弹出层内文字与背景对比度，避免与 BgInput 接近导致难以辨认 -->
            <Style x:Key="SimpleComboBoxItemStyle" TargetType="ComboBoxItem">
                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Padding" Value="8,6"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBoxItem">
                            <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                <ContentPresenter/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsHighlighted" Value="True">
                                    <Setter TargetName="Bd" Property="Background" Value="{StaticResource HoverBg}"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="Bd" Property="Background" Value="{StaticResource SelectionBg}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- 简洁下拉框样式：无前置图标/符号，用于节点设置等对话框，避免 Material Design 模板带来的多余视觉元素 -->
            <Style x:Key="SimpleComboBoxStyle" TargetType="ComboBox">
                <Setter Property="FocusVisualStyle" Value="{StaticResource FocusVisual}"/>
                <Setter Property="ItemContainerStyle" Value="{StaticResource SimpleComboBoxItemStyle}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBox">
                            <Border x:Name="MainBorder" Background="{TemplateBinding Background}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" CornerRadius="{StaticResource RadiusSm}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="24"/>
                                    </Grid.ColumnDefinitions>
                                    <!-- 整个编辑区可点击展开：ToggleButton 铺满整区，内层用近乎透明画笔保证整区参与命中测试 -->
                                    <ToggleButton x:Name="ToggleButton" Grid.Column="0" Grid.ColumnSpan="2" Focusable="False" IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" ClickMode="Press" Background="Transparent" BorderThickness="0" Padding="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border Background="#01000000" Padding="{TemplateBinding Padding}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                    </ToggleButton>
                                    <ContentPresenter x:Name="ContentSite" Grid.Column="0" Content="{TemplateBinding SelectionBoxItem}" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" HorizontalAlignment="Left" Margin="6,0,0,0" VerticalAlignment="Center" IsHitTestVisible="False"/>
                                    <Path x:Name="Arrow" Grid.Column="1" Data="M 0 0 L 4 4 L 8 0 Z" Fill="{TemplateBinding Foreground}" HorizontalAlignment="Center" VerticalAlignment="Center" Width="8" Height="4" IsHitTestVisible="False"/>
                                    <Popup x:Name="Popup" AllowsTransparency="True" Focusable="False" IsOpen="{TemplateBinding IsDropDownOpen}" Placement="Bottom" PopupAnimation="Slide">
                                        <Grid x:Name="DropDown" MaxHeight="{TemplateBinding MaxDropDownHeight}" MinWidth="{TemplateBinding ActualWidth}">
                                            <Border x:Name="DropDownBorder" Background="{TemplateBinding Background}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" CornerRadius="{StaticResource RadiusSm}">
                                                <ScrollViewer Margin="4,2">
                                                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                                </ScrollViewer>
                                            </Border>
                                        </Grid>
                                    </Popup>
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="HasItems" Value="False">
                                    <Setter TargetName="DropDownBorder" Property="MinHeight" Value="95"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- 对话框主按钮：Accent 色，用于「保存」等确认操作，与全局 Accent 一致 -->
            <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="Background" Value="{StaticResource Accent}"/>
                <Setter Property="Foreground" Value="{StaticResource SelectionFg}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="Bd" Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{StaticResource RadiusSm}" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Bd" Property="Opacity" Value="0.9"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- 对话框次按钮：灰底+边框，用于「取消」「测试连接」「管理…」 -->
            <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="Background" Value="{StaticResource ButtonBg}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                <Setter Property="BorderBrush" Value="{StaticResource ButtonBorder}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="Bd" Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{StaticResource RadiusSm}" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Bd" Property="Background" Value="{StaticResource ButtonHoverBg}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- 对话框输入框：与 ComboBox 一致的边框与圆角，增强层次感；MinHeight 保证文字不挤 -->
            <Style x:Key="DialogTextBoxStyle" TargetType="TextBox">
                <Setter Property="Background" Value="{StaticResource BgInput}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                <Setter Property="CaretBrush" Value="{StaticResource TextPrimary}"/>
                <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="8,8"/>
                <Setter Property="MinHeight" Value="20"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
            </Style>
            <!-- 对话框列表框：边框+圆角，与输入区统一；选中项使用 SelectionBg -->
            <Style x:Key="DialogListBoxStyle" TargetType="ListBox">
                <Setter Property="Background" Value="{StaticResource BgInput}"/>
                <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
            </Style>
            <!-- 标签页关闭按钮：≥28px 可点区域 + hover 反馈 (UI/UX Pro Max) -->
            <Style x:Key="TabCloseButtonStyle" TargetType="Button">
                <Setter Property="Content" Value="×"/>
                <Setter Property="MinWidth" Value="28"/>
                <Setter Property="MinHeight" Value="28"/>
                <Setter Property="Padding" Value="0"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="FocusVisualStyle" Value="{StaticResource FocusVisual}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="Bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}"
                                    CornerRadius="{StaticResource RadiusSm}" SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Bd" Property="Background" Value="{StaticResource HoverBg}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Application.Resources>
</Application>
